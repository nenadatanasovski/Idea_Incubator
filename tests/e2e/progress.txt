# E2E Test Progress Notes
# ========================
# This file tracks what each agent session accomplished.

[2025-12-31 Session 3] Working on TEST-BI-006
- Identified bug: Backend returns 'ideaCandidate' but frontend expects 'candidateUpdate'
- Fixed server/routes/ideation.ts to return 'candidateUpdate' instead of 'ideaCandidate'
- Also added confidence, viability, and risks fields to API response
- Fixed both /api/ideation/message and /api/ideation/button endpoints
- Committed fix: "Fix TEST-BI-006: Align candidateUpdate field name between backend and frontend"
- Browser session became unresponsive (detached Frame error), could not verify fix via UI
- Progress: 22/64 passing (code fix committed but NOT yet verified via browser)
- Next: Next agent should verify the fix works by navigating to /ideate, starting a session,
  and checking that the Idea Candidate panel updates when conversation progresses


[2025-12-31 19:49] Session 8 Complete
- Fixed: TEST-BI-006 (Button Response Updates Candidate)
- Root cause: mergeState() in orchestrator.ts was overwriting arrays with objects
  when LLM returned partial updates (e.g., {gaps: {}} overwrote gaps: [])
- Code changed: agents/ideation/orchestrator.ts - added check to skip updates 
  where existing value is array but update is not
- Verified: 6+ messages processed without 'gaps.some is not a function' error
- Verified: Idea Forming progress bar displays and updates
- Progress: 23/64 passing (was 22/64)
- Next: TEST-FH-001 (Form Display) or other pending tests


[2025-12-31 20:03] Session 9 Complete
- Fixed: Orchestrator not returning risks array (was missing from response)
- Code changed: agents/ideation/orchestrator.ts - added risks to OrchestratorResponse
- Passed: TEST-CM-001 (Candidate Panel), TEST-CM-002 (Title Gen), TEST-CM-003 (Summary Gen)
- Blocked: TEST-FH-001 through TEST-FH-004 (Forms are AI-generated, not deterministic)
- Verified: Candidate panel shows title, summary, confidence, viability correctly
- Progress: 26/64 passing (was 23/64)
- Next: TEST-CM-004 (Confidence Updates), TEST-CM-005 (Viability + Risks display)


[2025-12-31 20:07] Session 9 Update - Additional Fix
- Fixed: Confidence dropping during conversation
- Root cause: Candidate wasn't preserved when AI didn't include candidateTitle
- Code changed: agents/ideation/orchestrator.ts
  - Import candidateManager
  - Load existing candidate using getActiveForSession()
  - Use existing candidate for confidence/viability calculation
  - Preserve candidate in memory updates
- This should stabilize confidence scores during conversation


[2025-12-31 10:45] Session 10 Complete
- Fixed: Confidence calculator not handling string formats from LLM
- Root cause: LLM returns strings like "2 hours weekly on meal planning" but
  calculator expected objects like {description: "...", severity: "high"}
- Code changed: agents/ideation/confidence-calculator.ts
  - Problem Definition: Handle both object format and string format for frustrations/gaps
  - Target User: Handle string customerType, geography, and location fields
  - Solution Direction: Handle string productType and technicalDepth
  - Differentiation: Handle string competitors and expertise arrays
  - User Fit: Handle flat string constraints (budget, runway)
- Passed: TEST-CM-004 (Confidence Score Updates)
- Passed: TEST-CM-005 (Viability Score and Risks)
- Verified: Confidence goes from 0% to 90% with comprehensive message
- Verified: Confidence stays stable (does not drop) during conversation
- Verified: Viability shows 85% with risk items displayed
- Progress: 28/64 passing (was 26/64)
- Next: TEST-CM-006 (Capture Idea Button) or other pending tests


[2025-12-31 22:19] TEST-CM-006 PASSED: Capture Idea Button
- Added data-testid='capture-idea-btn' to IdeaCandidatePanel.tsx
- Also added data-testid for Save for Later and Discard buttons
- Verified: Button enabled at 85% confidence (threshold is 50%)
- Verified: Click creates new idea in database (id: 4eb68521...)
- Verified: Redirects to idea detail page with title, summary, incubation journey
- Verified: Session marked as 'completed' in database
- Verified: Candidate status changed to 'captured' with captured_idea_id linked
- Progress: 29/64 passing


[2025-12-31 Session 11] Web Search Integration Fixed
- Fixed: Web search was parsing but never executing
- Root cause: orchestrator.ts didn't call performWebSearch()
- Root cause: exec() didn't handle multiline prompts correctly
- Changed to spawn() with stdin.write() for prompts
- Added data-testid to Capture Idea button
- Passed: TEST-CM-006 (Capture Idea Button)
- Verified: 17-20 web search results per query batch
- Progress: 29/64 passing (was 28/64)
- Next: TEST-CM-007 (Save for Later), TEST-CV tests
[2026-01-01 14:33] TEST-SL-008 PASSED: Session Timeout Behavior
- Fixed: Error message format handling in useIdeationAPI.ts
- Root cause: Backend returns {error: 'Session is not active'} but frontend expected {error: {message: 'string'}}
- Code changed: frontend/src/hooks/useIdeationAPI.ts - handle both string and object error formats
- Verified: Clear timeout message displayed ('Your session has expired. Please start a new session.')
- Verified: Go Back button takes user to entry page where they can start new session
- Verified: Old session marked as 'abandoned' in database
- Progress: 30/64 passing (was 29/64)
