{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Coding Loop Configuration",
  "description": "Configuration schema for coding loop harnesses",
  "type": "object",
  "required": ["name", "specs_dir", "test_state_file"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Human-readable name for this loop",
      "minLength": 1
    },
    "specs_dir": {
      "type": "string",
      "description": "Path to specs directory (relative to project root or absolute)",
      "minLength": 1
    },
    "test_state_file": {
      "type": "string",
      "description": "Path to test-state.json (relative to specs_dir or absolute)",
      "default": "test-state.json"
    },
    "project_dir": {
      "type": "string",
      "description": "Project root directory. If not specified, uses parent of coding-loops directory",
      "default": null
    },
    "model": {
      "type": "string",
      "description": "Claude model to use",
      "default": "claude-opus-4-6",
      "enum": [
        "claude-opus-4-6",
        "claude-opus-4-5-20251101",
        "claude-sonnet-4-20250514",
        "claude-3-5-sonnet-20241022"
      ]
    },
    "max_attempts": {
      "type": "integer",
      "description": "Maximum attempts per test before blocking",
      "default": 3,
      "minimum": 1,
      "maximum": 10
    },
    "auto_continue_delay": {
      "type": "number",
      "description": "Seconds to wait between iterations",
      "default": 3,
      "minimum": 0,
      "maximum": 60
    },
    "priority": {
      "type": "integer",
      "description": "Priority level (1=highest, 10=lowest)",
      "default": 5,
      "minimum": 1,
      "maximum": 10
    },
    "health_check": {
      "type": "object",
      "description": "Health check configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether to write health check files",
          "default": true
        },
        "interval_seconds": {
          "type": "integer",
          "description": "How often to update health file",
          "default": 30,
          "minimum": 5
        },
        "file": {
          "type": "string",
          "description": "Health check file name",
          "default": "health.json"
        }
      },
      "default": {
        "enabled": true,
        "interval_seconds": 30,
        "file": "health.json"
      }
    },
    "logging": {
      "type": "object",
      "description": "Logging configuration",
      "properties": {
        "transcript_tail_lines": {
          "type": "integer",
          "description": "Number of lines to include from global transcript",
          "default": 100,
          "minimum": 10
        },
        "max_transcript_chars": {
          "type": "integer",
          "description": "Maximum characters from previous transcripts",
          "default": 50000,
          "minimum": 5000
        }
      },
      "default": {
        "transcript_tail_lines": 100,
        "max_transcript_chars": 50000
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata for orchestration",
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "created_by": {
          "type": "string"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "description": {
          "type": "string"
        }
      }
    }
  },
  "additionalProperties": false
}
