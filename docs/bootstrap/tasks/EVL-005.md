# EVL-005: User Profile Integration for Fit Scores

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 4 - Evaluation System |
| **Depends On** | EVL-001 |
| **Blocks** | None |
| **Priority** | P2 |
| **Owner** | Human + Claude Code |

---

## Summary

Integrate user profiles into the evaluation system to provide personalized Fit scores (FT1-FT5). Without a profile, Fit scores default to 5/10 with low confidence. With a profile, scores reflect the actual match between user and idea.

---

## Context

### Fit Criteria

| Criterion | Code | What Profile Provides |
|-----------|------|----------------------|
| Goal Alignment | FT1 | User's goals (income, impact, learning) |
| Passion Match | FT2 | User's interests and motivations |
| Skill Match | FT3 | User's skills and gaps |
| Network Value | FT4 | User's connections and communities |
| Life Stage Fit | FT5 | Availability, runway, risk tolerance |

### Profile Data

```typescript
interface UserProfile {
  goals: {
    primary: 'income' | 'impact' | 'learning' | 'portfolio';
    secondary?: string[];
    specificTargets?: string[];
  };
  passion: {
    interests: string[];
    motivations: string[];
    domainExperience: string[];
  };
  skills: {
    technical: Skill[];
    business: Skill[];
    gaps: string[];
  };
  network: {
    industries: string[];
    connections: number;
    communities: string[];
  };
  lifeStage: {
    employment: 'employed' | 'freelance' | 'unemployed' | 'student';
    hoursAvailable: number;
    runwayMonths?: number;
    riskTolerance: 'low' | 'medium' | 'high';
  };
}
```

---

## Requirements

1. **Profile Loading**:
   - Load user profile during evaluation
   - Handle missing profiles gracefully
   - Support profile linking to ideas

2. **Fit Scoring Logic**:
   - Compare idea requirements to profile
   - Score each criterion based on match
   - Generate personalized rationale

3. **Default Behavior**:
   - Without profile: 5/10 with 20% confidence
   - With profile: Accurate score with 80%+ confidence
   - Prompt user to create profile

4. **Profile CLI**:
   - `npm run profile create` - Interactive creation
   - `npm run profile show` - Display profile
   - `npm run profile link` - Link to idea

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | Profile loads during eval | Check evaluation logs |
| 2 | Fit scores change with profile | Compare with/without profile |
| 3 | Rationale is personalized | Review FT1-FT5 rationales |
| 4 | CLI commands work | Test each command |

**FAIL** if any criterion is not met.

---

## Output Files

```
profiles/{user-slug}.json                  <- User profile storage
utils/profile-manager.ts                   <- Profile CRUD
agents/evaluator.ts                        <- Updated for profile
cli/profile.ts                             <- CLI commands
tests/unit/profile-evaluation.test.ts
```

---

## Code Template

```typescript
// utils/profile-manager.ts

export class ProfileManager {
  async getProfile(userSlug: string): Promise<UserProfile | null> {
    const profilePath = `profiles/${userSlug}.json`;
    if (!fs.existsSync(profilePath)) return null;
    return JSON.parse(await fs.readFile(profilePath, 'utf-8'));
  }

  async createProfile(userSlug: string, profile: UserProfile): Promise<void> {
    const profilePath = `profiles/${userSlug}.json`;
    await fs.writeFile(profilePath, JSON.stringify(profile, null, 2));
  }

  async linkToIdea(ideaSlug: string, profileSlug: string): Promise<void> {
    // Store link in idea metadata
  }
}

// agents/evaluator.ts - Fit scoring
async function scoreFitCriteria(
  criterion: string,
  ideaContext: IdeaContext,
  profile: UserProfile | null
): Promise<CriterionScore> {
  if (!profile) {
    return {
      criterion,
      category: 'Fit',
      score: 5,
      confidence: 0.2,
      rationale: 'No user profile available. Create a profile for accurate Fit scoring.',
      evidence: []
    };
  }

  // Score based on profile match
  switch (criterion) {
    case 'FT1': return scoreGoalAlignment(ideaContext, profile);
    case 'FT2': return scorePassionMatch(ideaContext, profile);
    // ... etc
  }
}
```

---

## Validation

```bash
# Create test profile
npm run profile create -- --user test-user

# Link to idea
npm run profile link -- test-idea test-user

# Run evaluation
npm run evaluate test-idea

# Verify personalized Fit scores
cat users/test-user/ideas/test-idea/analysis/evaluation.json | jq '.scores[] | select(.category == "Fit")'
```

---

## Next Steps

After completing: Implement evaluation caching (EVL-006, optional P4).
