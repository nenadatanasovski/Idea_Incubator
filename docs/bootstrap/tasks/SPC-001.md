# SPC-001: Context Loader Implementation

---

## Metadata

| Field          | Value                       |
| -------------- | --------------------------- |
| **Phase**      | 1 - Spec Agent              |
| **Depends On** | AGT-003, AGT-005            |
| **Blocks**     | SPC-003, SPC-004            |
| **Priority**   | P1                          |
| **Owner**      | Build Agent (after Phase 1) |

---

## Summary

Implement the context loader that gathers all relevant information before spec generation: CLAUDE.md, templates, existing patterns, and gotchas.

---

## Requirements

1. **File Loading**:
   - Load CLAUDE.md from project root
   - Load relevant template files from `templates/unified/build/`
   - Load idea README.md if exists
   - Load gotchas from Knowledge Base (hardcoded initially)

2. **Context Assembly**:
   - Merge contexts with clear section markers
   - Respect token limits (< 50k for context)
   - Prioritize by relevance

3. **Output Format**:
   - Return structured context object
   - Include source attribution
   - Include token count estimates

---

## Pass Criteria

**PASS** when ALL of the following are true:

| #   | Criterion                   | How to Verify                                                                           |
| --- | --------------------------- | --------------------------------------------------------------------------------------- |
| 1   | File exists                 | `test -f agents/specification/context-loader.ts` returns 0                              |
| 2   | Exports ContextLoader class | `grep -q "export class ContextLoader" agents/specification/context-loader.ts` returns 0 |
| 3   | Has loadClaude method       | `grep -q "loadClaude" agents/specification/context-loader.ts` returns 0                 |
| 4   | Has loadTemplates method    | `grep -q "loadTemplates" agents/specification/context-loader.ts` returns 0              |
| 5   | Has loadGotchas method      | `grep -q "loadGotchas" agents/specification/context-loader.ts` returns 0                |
| 6   | TypeScript compiles         | `npx tsc --noEmit agents/specification/context-loader.ts` returns 0                     |
| 7   | Unit tests pass             | `npm test -- --grep "context-loader"` passes                                            |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/specification/
└── context-loader.ts
```

---

## Code Template

```typescript
// agents/specification/context-loader.ts

import { readFile } from "fs/promises";
import { existsSync } from "fs";

export interface LoadedContext {
  claude: string;
  templates: Record<string, string>;
  gotchas: Gotcha[];
  ideaReadme?: string;
  tokenEstimate: number;
}

export interface Gotcha {
  content: string;
  filePattern: string;
  actionType: string;
}

export class ContextLoader {
  private projectRoot: string;

  constructor(projectRoot: string) {
    this.projectRoot = projectRoot;
  }

  async load(ideaSlug?: string): Promise<LoadedContext> {
    // Implementation here
  }

  async loadClaude(): Promise<string> {
    // Load CLAUDE.md
  }

  async loadTemplates(): Promise<Record<string, string>> {
    // Load templates/unified/build/*
  }

  async loadGotchas(): Promise<Gotcha[]> {
    // Return hardcoded gotchas for v0.1
  }
}
```

---

## Validation

```bash
# TypeScript compiles
npx tsc --noEmit agents/specification/context-loader.ts

# Unit tests
npm test -- --grep "context-loader"
```
