# IDE-004: Web Search Integration

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 3 - Ideation System |
| **Depends On** | IDE-001 |
| **Blocks** | None |
| **Priority** | P3 |
| **Owner** | Human + Claude Code |

---

## Summary

Integrate web search capabilities into the ideation agent to provide market research, competitive analysis, and validation data. The agent can search for relevant information when users ask about markets, competitors, or trends.

---

## Context

### Use Cases

| Trigger | Search Purpose |
|---------|---------------|
| "Who are the competitors?" | Competitive analysis |
| "How big is this market?" | Market size research |
| "Is this idea validated?" | Find similar products/startups |
| "What do users say about X?" | User sentiment research |

### Search Providers

| Provider | Pros | Cons |
|----------|------|------|
| **Tavily** | AI-optimized, good summaries | Cost per query |
| **SerpAPI** | Google results | Need API key |
| **DuckDuckGo** | Free, no tracking | Limited API |

---

## Requirements

1. **Search Service**:
   - Abstract provider implementation
   - Rate limiting and caching
   - Error handling for failures

2. **Query Generation**:
   - Convert user questions to search queries
   - Multiple query strategies for breadth
   - Filter irrelevant results

3. **Result Processing**:
   - Extract key information from results
   - Summarize for context inclusion
   - Track sources for citation

4. **Context Integration**:
   - Include relevant results in Claude context
   - Don't overwhelm with too much data
   - Let Claude synthesize findings

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | Search returns results | Test with sample query |
| 2 | Results are relevant | Manual review of output |
| 3 | Sources tracked | Verify URLs in response |
| 4 | Graceful failure | Test with invalid queries |

**FAIL** if any criterion is not met.

---

## Output Files

```
services/web-search.ts                     <- Search service
agents/ideation/search-integration.ts      <- Integration logic
types/search.ts                            <- TypeScript types
tests/ideation/web-search.test.ts
```

---

## Code Template

```typescript
// services/web-search.ts

interface SearchResult {
  title: string;
  url: string;
  snippet: string;
  score: number;
  source: string;
}

interface SearchOptions {
  maxResults?: number;
  recency?: 'day' | 'week' | 'month' | 'year' | 'any';
  includeNews?: boolean;
}

export class WebSearchService {
  private provider: SearchProvider;
  private cache: Map<string, SearchResult[]>;
  private rateLimiter: RateLimiter;

  constructor(provider: 'tavily' | 'serpapi' | 'duckduckgo') {
    this.provider = createProvider(provider);
    this.cache = new Map();
    this.rateLimiter = new RateLimiter({ maxPerMinute: 10 });
  }

  async search(query: string, options?: SearchOptions): Promise<SearchResult[]> {
    // Check cache
    const cacheKey = `${query}-${JSON.stringify(options)}`;
    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey)!;
    }

    // Rate limit
    await this.rateLimiter.acquire();

    // Execute search
    const results = await this.provider.search(query, options);

    // Cache results
    this.cache.set(cacheKey, results);

    return results;
  }
}
```

---

## Validation

```bash
# Run search tests
npm test -- tests/ideation/web-search.test.ts

# Manual test
curl -X POST http://localhost:3001/api/ideation/search \
  -H "Content-Type: application/json" \
  -d '{"query": "personal finance apps market size 2024"}'

# Verify in conversation
# Start session, ask "Who are the main competitors in personal finance?"
```

---

## Configuration

```bash
# .env
TAVILY_API_KEY=tvly-...
# Or
SERPAPI_KEY=...
```

---

## Next Steps

After completing: Generate handoff document (IDE-005).
