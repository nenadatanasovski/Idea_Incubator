# BLD-004: Claude Code Generator

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 2 - Build Agent |
| **Depends On** | BLD-003 |
| **Blocks** | BLD-005 |
| **Priority** | P1 |
| **Owner** | Human (then Build Agent) |

---

## Summary

Generate code using Claude based on task requirements, code templates, and context.

---

## Requirements

1. **Code Generation**:
   - Use task code template as starting point
   - Apply conventions from CLAUDE.md
   - Include gotcha mitigations

2. **Quality Checks**:
   - Verify syntax before outputting
   - Check for common errors
   - Apply linting rules

3. **Iteration**:
   - Handle feedback from validation
   - Regenerate with corrections
   - Track generation attempts

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f agents/build/code-generator.ts` returns 0 |
| 2 | Exports CodeGenerator | `grep -q "export class CodeGenerator" agents/build/code-generator.ts` returns 0 |
| 3 | Has generate method | `grep -q "generate(" agents/build/code-generator.ts` returns 0 |
| 4 | Uses Claude API | `grep -q "anthropic" agents/build/code-generator.ts` returns 0 |
| 5 | Has quality checks | `grep -q "validate" agents/build/code-generator.ts` returns 0 |
| 6 | TypeScript compiles | `npx tsc --noEmit agents/build/code-generator.ts` returns 0 |
| 7 | Unit tests pass | `npm test -- --grep "code-generator"` passes |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/build/
└── code-generator.ts
```

---

## Code Template

```typescript
// agents/build/code-generator.ts

export interface GeneratedCode {
  content: string;
  language: string;
  valid: boolean;
  errors: string[];
  attempts: number;
}

export class CodeGenerator {
  async generate(task: AtomicTask, context: TaskContext): Promise<GeneratedCode> {
    // Generate code using Claude
  }

  async regenerate(task: AtomicTask, feedback: string): Promise<GeneratedCode> {
    // Fix based on feedback
  }

  private validateSyntax(code: string, language: string): { valid: boolean; errors: string[] } {
    // Check syntax before returning
  }
}
```

---

## Validation

```bash
npx tsc --noEmit agents/build/code-generator.ts
npm test -- --grep "code-generator"
```
