# TAK-008: ValidationGate Service

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 3 - Core Services |
| **Depends On** | TAK-005, TAK-006, TAK-007 |
| **Blocks** | TAK-015b (SuggestionEngine), TAK-016 (TaskAgent) |
| **Priority** | P1 |
| **Owner** | Build Agent |

---

## Summary

Implement the ValidationGate class that validates tasks before allowing execution. Checks required fields, test requirements, and detects ambiguous descriptions.

---

## Context

### Validation Flow

```
Task Created → ValidationGate.validate() → Pass/Block
                     ↓
              Load validation_rules from DB
                     ↓
              Check required fields
                     ↓
              Check test requirements (API/UI)
                     ↓
              Detect ambiguous language
                     ↓
              Return blocking vs non-blocking issues
                     ↓
              Create task_blocks records if blocking
```

---

## Requirements

1. **ValidationGate class**:
   - Load validation rules from database
   - Check required fields with configurable rules
   - Check test requirements based on category
   - Detect ambiguous descriptions via NLP patterns
   - Return blocking vs non-blocking issues
   - Create task_blocks records for blocking issues

2. **Methods**:
   - `validate(task: Task): Promise<ValidationResult>`
   - `loadRules(): Promise<ValidationRule[]>`
   - `checkRequiredFields(task, rules): ValidationIssue[]`
   - `checkTestRequirements(task, rules): ValidationIssue[]`
   - `detectAmbiguity(task, rules): ValidationIssue[]`

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f server/services/task-agent/validation-gate.ts` returns 0 |
| 2 | Exports ValidationGate | `grep -q "export class ValidationGate" server/services/task-agent/validation-gate.ts` returns 0 |
| 3 | Has validate method | `grep -q "async validate" server/services/task-agent/validation-gate.ts` returns 0 |
| 4 | Has loadRules method | `grep -q "loadRules" server/services/task-agent/validation-gate.ts` returns 0 |
| 5 | Has ambiguity detection | `grep -q "detectAmbiguity\|ambiguous" server/services/task-agent/validation-gate.ts` returns 0 |
| 6 | TypeScript compiles | `npx tsc --noEmit server/services/task-agent/validation-gate.ts` returns 0 |

**FAIL** if any criterion is not met.

---

## Output Files

```
server/services/task-agent/
└── validation-gate.ts
```

---

## Gotchas

- Always validate before allowing task execution
- Blocking issues prevent task from leaving 'draft' status
- Non-blocking issues are warnings that don't stop execution
- Ambiguity detection uses configurable vague terms list

---

## Validation

```bash
npx tsc --noEmit server/services/task-agent/validation-gate.ts
npm test -- --grep "validation-gate"
```

---

## Next Steps

After completing: Implement DeduplicationEngine (TAK-009).
