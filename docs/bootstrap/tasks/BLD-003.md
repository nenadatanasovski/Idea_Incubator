# BLD-003: Task Executor

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 2 - Build Agent |
| **Depends On** | BLD-002 |
| **Blocks** | BLD-004, BLD-006 |
| **Priority** | P1 |
| **Owner** | Human (then Build Agent) |

---

## Summary

Execute atomic tasks in dependency order, managing state and handling failures.

---

## Requirements

1. **Execution Loop**:
   - Process tasks in dependency order
   - Track task state (pending, running, done, failed)
   - Handle blocking questions

2. **State Management**:
   - Save progress after each task
   - Resume from last checkpoint
   - Track outputs per task

3. **Failure Handling**:
   - Retry failed tasks with backoff
   - Skip to independent tasks on failure
   - Flag for human intervention

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f agents/build/task-executor.ts` returns 0 |
| 2 | Exports TaskExecutor | `grep -q "export class TaskExecutor" agents/build/task-executor.ts` returns 0 |
| 3 | Has execute method | `grep -q "execute(" agents/build/task-executor.ts` returns 0 |
| 4 | Has state tracking | `grep -q "TaskState" agents/build/task-executor.ts` returns 0 |
| 5 | Has retry logic | `grep -q "retry" agents/build/task-executor.ts` returns 0 |
| 6 | TypeScript compiles | `npx tsc --noEmit agents/build/task-executor.ts` returns 0 |
| 7 | Unit tests pass | `npm test -- --grep "task-executor"` passes |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/build/
└── task-executor.ts
```

---

## Code Template

```typescript
// agents/build/task-executor.ts

export type TaskState = 'pending' | 'running' | 'done' | 'failed' | 'blocked';

export interface ExecutionResult {
  taskId: string;
  state: TaskState;
  output?: string;
  error?: string;
  duration: number;
}

export class TaskExecutor {
  async execute(tasks: AtomicTask[]): Promise<ExecutionResult[]> {
    // Execute in dependency order
  }

  async executeOne(task: AtomicTask, context: TaskContext): Promise<ExecutionResult> {
    // Execute single task
  }

  private async handleFailure(task: AtomicTask, error: Error): Promise<void> {
    // Retry or escalate
  }
}
```

---

## Validation

```bash
npx tsc --noEmit agents/build/task-executor.ts
npm test -- --grep "task-executor"
```
