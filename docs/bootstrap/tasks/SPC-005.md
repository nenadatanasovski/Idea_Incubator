# SPC-005: Task Generator

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 1 - Spec Agent |
| **Depends On** | SPC-002, SPC-004 |
| **Blocks** | SPC-006, SPC-008 |
| **Priority** | P1 |
| **Owner** | Build Agent (after Phase 1) |

---

## Summary

Generate atomic, implementable tasks from analyzed requirements. Each task = one file, one action.

---

## Requirements

1. **Task Structure**:
   - Unique ID (T-XXX)
   - Phase assignment (database → types → queries → api → tests)
   - Single file target
   - Clear action (CREATE/UPDATE)

2. **Dependency Management**:
   - Detect dependencies between tasks
   - Order tasks by dependency
   - Flag circular dependencies

3. **Validation Generation**:
   - Generate runnable validation command for each task
   - Include expected output
   - Use actual project tools

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f agents/specification/task-generator.ts` returns 0 |
| 2 | Exports TaskGenerator | `grep -q "export class TaskGenerator" agents/specification/task-generator.ts` returns 0 |
| 3 | Has generate method | `grep -q "generate(" agents/specification/task-generator.ts` returns 0 |
| 4 | Has AtomicTask interface | `grep -q "interface AtomicTask" agents/specification/task-generator.ts` returns 0 |
| 5 | Includes phase ordering | `grep -q "database.*types.*api" agents/specification/task-generator.ts` returns 0 |
| 6 | TypeScript compiles | `npx tsc --noEmit agents/specification/task-generator.ts` returns 0 |
| 7 | Unit tests pass | `npm test -- --grep "task-generator"` passes |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/specification/
└── task-generator.ts
```

---

## Code Template

```typescript
// agents/specification/task-generator.ts

export interface AtomicTask {
  id: string;           // T-001
  phase: Phase;         // database, types, queries, api, tests
  action: 'CREATE' | 'UPDATE';
  file: string;         // Exact file path
  requirements: string[];
  gotchas: string[];
  validation: {
    command: string;
    expected: string;
  };
  codeTemplate: string;
  dependsOn: string[];  // Task IDs
}

export type Phase = 'database' | 'types' | 'queries' | 'api' | 'tests';

export class TaskGenerator {
  generate(requirements: AnalyzedRequirements): AtomicTask[] {
    // Generate tasks ordered by phase
  }

  private orderByDependency(tasks: AtomicTask[]): AtomicTask[] {
    // Topological sort
  }

  private generateValidation(task: AtomicTask): { command: string; expected: string } {
    // Generate runnable validation
  }
}
```

---

## Validation

```bash
npx tsc --noEmit agents/specification/task-generator.ts
npm test -- --grep "task-generator"
```
