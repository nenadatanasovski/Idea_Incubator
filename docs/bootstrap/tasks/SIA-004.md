# SIA-004: Gotcha Extractor

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 9 - Self-Improvement Agent |
| **Depends On** | SIA-003 |
| **Blocks** | SIA-006 |
| **Priority** | P1 |
| **Owner** | Human + Claude Code |

---

## Summary

Implement the gotcha extractor that identifies mistakes, pitfalls, and issues from failed task executions. Gotchas are stored in the Knowledge Base to prevent future occurrences.

---

## Context

### Gotcha Categories

| Category | Example |
|----------|---------|
| **Syntax** | "Use TEXT for dates in SQLite" |
| **Logic** | "Always check null before accessing" |
| **Pattern** | "Import order affects initialization" |
| **Environment** | "Node version affects ESM behavior" |

---

## Requirements

1. **Failure Analysis**:
   - Parse error messages
   - Identify root cause
   - Extract actionable lesson

2. **Gotcha Formatting**:
   - Clear description
   - File pattern match
   - Action type association
   - Confidence score

3. **Deduplication**:
   - Check against existing gotchas
   - Merge similar entries
   - Update confidence on reoccurrence

---

## Pass Criteria

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | Gotchas extracted | Test with failed execution |
| 2 | Properly formatted | Check structure |
| 3 | Deduplication works | Add duplicate, verify merge |

---

## Output Files

```
agents/sia/gotcha-extractor.ts
```

---

## Code Template

```typescript
interface Gotcha {
  id: string;
  description: string;
  category: string;
  filePattern: string;
  actionType?: string;
  confidence: number;
  occurrences: number;
  source: {
    executionId: string;
    taskId: string;
    error: string;
  };
}

export async function extractGotchas(
  analysis: ExecutionAnalysis
): Promise<Gotcha[]> {
  // Analyze failures
  // Extract lessons
  // Format as gotchas
  // Deduplicate
}
```
