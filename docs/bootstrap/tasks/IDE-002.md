# IDE-002: Phase Transition Logic Refinement

---

## Metadata

| Field          | Value               |
| -------------- | ------------------- |
| **Phase**      | 3 - Ideation System |
| **Depends On** | IDE-001             |
| **Blocks**     | IDE-005             |
| **Priority**   | P2                  |
| **Owner**      | Human + Claude Code |

---

## Summary

Refine the logic that determines when an ideation session should transition from one phase to the next. Implement clearer criteria and provide user visibility into transition requirements.

---

## Context

### Ideation Phases

| Phase          | Purpose             | Exit Criteria                                     |
| -------------- | ------------------- | ------------------------------------------------- |
| **EXPLORING**  | Discover idea shape | Target user, problem, solution concept identified |
| **NARROWING**  | Define scope        | MVP features, differentiator defined              |
| **VALIDATING** | Test assumptions    | 3+ assumptions validated, risks identified        |
| **REFINING**   | Polish concept      | Confidence > 75%, brief ready                     |
| **COMPLETE**   | Ready for spec      | Handoff document generated                        |

### Current Issues

| Issue                      | Impact                          |
| -------------------------- | ------------------------------- |
| Transitions too aggressive | User feels rushed               |
| Criteria unclear           | User doesn't know what's needed |
| No manual override         | User can't stay in phase        |

---

## Requirements

1. **Transition Criteria Engine**:
   - Define explicit criteria for each transition
   - Support weighted criteria (some more important)
   - Calculate transition readiness percentage

2. **User Visibility**:
   - Show current phase and progress
   - Display remaining criteria to meet
   - Provide hints for what to discuss next

3. **Manual Controls**:
   - Allow user to stay in current phase
   - Allow user to skip to next phase
   - Allow user to go back (with warning)

4. **Transition Events**:
   - Emit events on phase change
   - Log transition decisions
   - Support transition webhooks

---

## Pass Criteria

**PASS** when ALL of the following are true:

| #   | Criterion                | How to Verify              |
| --- | ------------------------ | -------------------------- |
| 1   | Criteria clearly defined | Review phase-manager.ts    |
| 2   | Progress shown to user   | Check session API response |
| 3   | Manual controls work     | Test skip/stay commands    |
| 4   | Transitions logged       | Check event log            |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/ideation/phase-manager.ts           <- Transition logic
agents/ideation/phase-criteria.ts          <- Criteria definitions
server/routes/ideation/phase-routes.ts     <- Manual control endpoints
tests/ideation/phase-transitions.test.ts
```

---

## Code Template

```typescript
// agents/ideation/phase-criteria.ts

interface PhaseCriterion {
  id: string;
  label: string;
  weight: number; // 0-1, importance
  check: (signals: ExtractedSignals) => boolean;
}

export const PHASE_CRITERIA: Record<string, PhaseCriterion[]> = {
  EXPLORING_TO_NARROWING: [
    {
      id: "target-user",
      label: "Target user identified",
      weight: 1.0,
      check: (signals) =>
        signals.artifacts.some((a) => a.type === "target-user"),
    },
    {
      id: "problem",
      label: "Problem statement defined",
      weight: 1.0,
      check: (signals) => signals.artifacts.some((a) => a.type === "problem"),
    },
    {
      id: "solution-concept",
      label: "Solution concept described",
      weight: 0.8,
      check: (signals) =>
        signals.artifacts.some((a) => a.type === "solution-concept"),
    },
  ],
  // ... other transitions
};

export function calculateTransitionReadiness(
  currentPhase: string,
  signals: ExtractedSignals,
): { ready: boolean; percentage: number; missing: string[] } {
  const criteria = PHASE_CRITERIA[`${currentPhase}_TO_NEXT`] || [];
  // Calculate weighted readiness...
}
```

---

## Validation

```bash
# Run phase transition tests
npm test -- tests/ideation/phase-transitions.test.ts

# Manual test flow
# 1. Start session in EXPLORING
# 2. Add messages until criteria met
# 3. Verify automatic transition suggestion
# 4. Test manual skip/stay commands
```

---

## Next Steps

After completing: Enhance signal extraction (IDE-003).
