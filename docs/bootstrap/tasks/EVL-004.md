# EVL-004: Synthesis Document Generation

---

## Metadata

| Field          | Value                     |
| -------------- | ------------------------- |
| **Phase**      | 4 - Evaluation System     |
| **Depends On** | EVL-001, EVL-002, EVL-003 |
| **Blocks**     | None                      |
| **Priority**   | P2                        |
| **Owner**      | Human + Claude Code       |

---

## Summary

Generate a comprehensive synthesis document that combines evaluation scores, red team challenges, and debate outcomes into a single actionable report. This is the final deliverable of the evaluation process.

---

## Context

### Synthesis Components

| Component             | Source     | Purpose                            |
| --------------------- | ---------- | ---------------------------------- |
| **Executive Summary** | All        | Quick overview for decision-making |
| **Score Dashboard**   | EVL-001    | Visual representation of scores    |
| **Key Strengths**     | Evaluation | What works well                    |
| **Critical Concerns** | Red Team   | What needs attention               |
| **Debate Highlights** | Debate     | Key arguments and outcomes         |
| **Recommendations**   | Synthesis  | Next steps                         |

### Document Structure

```markdown
# Evaluation Synthesis: {Idea Name}

## Executive Summary

One paragraph conclusion with overall recommendation.

## Scores at a Glance

Visual dashboard of all 30 criteria scores.

## Strengths (Top 5)

Highest scoring criteria with rationale.

## Concerns (Top 5)

Lowest scoring criteria with challenges.

## Debate Summary

Key points from each round.

## Recommendations

Specific actions to improve the idea.

## Detailed Scores

Full breakdown by category.
```

---

## Requirements

1. **Content Aggregation**:
   - Pull from evaluation, red team, debate
   - Identify patterns and themes
   - Resolve contradictions

2. **Synthesis Logic**:
   - Use Claude to synthesize findings
   - Generate actionable insights
   - Prioritize recommendations

3. **Document Generation**:
   - Markdown output for readability
   - JSON output for programmatic use
   - Support multiple formats

4. **Quality Validation**:
   - Check all sections populated
   - Verify internal consistency
   - Validate recommendations

---

## Pass Criteria

**PASS** when ALL of the following are true:

| #   | Criterion                  | How to Verify               |
| --- | -------------------------- | --------------------------- |
| 1   | All sections present       | Parse document structure    |
| 2   | Scores visualized          | Dashboard renders correctly |
| 3   | Recommendations actionable | Manual review               |
| 4   | No contradictions          | Cross-reference sources     |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/synthesis.ts                        <- Synthesis engine
templates/unified/analysis/synthesis.md.template
users/{user}/ideas/{idea}/analysis/synthesis.md <- Output
tests/unit/agents/synthesis.test.ts
```

---

## Code Template

```typescript
// agents/synthesis.ts

interface SynthesisResult {
  ideaSlug: string;
  executiveSummary: string;
  overallRecommendation: "proceed" | "iterate" | "pivot" | "pause";
  overallScore: number;
  strengths: Insight[];
  concerns: Insight[];
  debateHighlights: string[];
  recommendations: Recommendation[];
  detailedScores: EvaluationResult;
}

interface Recommendation {
  priority: "high" | "medium" | "low";
  area: string;
  action: string;
  expectedImpact: string;
  effort: "low" | "medium" | "high";
}

export async function generateSynthesis(
  evaluation: EvaluationResult,
  redTeam: RedTeamResult,
  debate: DebateResult,
): Promise<SynthesisResult> {
  // Aggregate all findings
  const findings = aggregateFindings(evaluation, redTeam, debate);

  // Generate executive summary
  const summary = await generateExecutiveSummary(findings);

  // Identify top strengths and concerns
  const strengths = identifyStrengths(evaluation, 5);
  const concerns = identifyConcerns(evaluation, redTeam, 5);

  // Generate recommendations
  const recommendations = await generateRecommendations(findings);

  // Determine overall recommendation
  const overallRec = determineRecommendation(evaluation.overallScore, concerns);

  return {
    executiveSummary: summary,
    overallRecommendation: overallRec,
    overallScore: evaluation.overallScore,
    strengths,
    concerns,
    debateHighlights: extractDebateHighlights(debate),
    recommendations,
    detailedScores: evaluation,
  };
}
```

---

## Validation

```bash
# Run synthesis tests
npm test -- tests/unit/agents/synthesis.test.ts

# Generate synthesis for idea
npm run evaluate test-idea -- --full

# Review output
cat users/default/ideas/test-idea/analysis/synthesis.md
```

---

## Next Steps

After completing: Integrate user profiles for Fit scoring (EVL-005).
