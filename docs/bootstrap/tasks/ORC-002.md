# ORC-002: Agent Status Tracking

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 3 - Orchestration |
| **Depends On** | ORC-001 |
| **Blocks** | WEB-002 |
| **Priority** | P1 |
| **Owner** | Build Agent |

---

## Summary

Track and report status of all running agents in real-time.

---

## Requirements

1. **Status Model**:
   - Agent ID and type
   - Current state (idle/working/blocked/error)
   - Current task description
   - Progress if applicable
   - Last activity timestamp

2. **Status Updates**:
   - Subscribe to agent events
   - Update status on state changes
   - Detect stale/hung agents

3. **API**:
   - Get all agent statuses
   - Get specific agent status
   - Historical status (last N changes)

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f server/orchestration/agent-status.ts` returns 0 |
| 2 | Exports AgentStatusTracker | `grep -q "export class AgentStatusTracker" server/orchestration/agent-status.ts` returns 0 |
| 3 | Has getAll method | `grep -q "getAll(" server/orchestration/agent-status.ts` returns 0 |
| 4 | Has getStatus method | `grep -q "getStatus(" server/orchestration/agent-status.ts` returns 0 |
| 5 | Subscribes to events | `grep -q "subscribe" server/orchestration/agent-status.ts` returns 0 |
| 6 | Has 4 states | `grep -c "idle\|working\|blocked\|error" server/orchestration/agent-status.ts` >= 4 |
| 7 | TypeScript compiles | `npx tsc --noEmit server/orchestration/agent-status.ts` returns 0 |
| 8 | Unit tests pass | `npm test -- --grep "agent-status"` passes |

**FAIL** if any criterion is not met.

---

## Output Files

```
server/orchestration/
└── agent-status.ts
```

---

## Code Template

```typescript
// server/orchestration/agent-status.ts

export type AgentState = 'idle' | 'working' | 'blocked' | 'error';

export interface AgentStatus {
  agentId: string;
  agentType: string;
  state: AgentState;
  currentTask?: string;
  progress?: number;
  lastActivity: Date;
  errorMessage?: string;
}

export class AgentStatusTracker {
  private statuses: Map<string, AgentStatus> = new Map();

  constructor(private eventBus: EventBus) {
    this.subscribeToEvents();
  }

  getAll(): AgentStatus[] {
    return Array.from(this.statuses.values());
  }

  getStatus(agentId: string): AgentStatus | undefined {
    return this.statuses.get(agentId);
  }

  private subscribeToEvents(): void {
    // Listen for agent events, update statuses
  }
}
```

---

## Validation

```bash
npx tsc --noEmit server/orchestration/agent-status.ts
npm test -- --grep "agent-status"
```
