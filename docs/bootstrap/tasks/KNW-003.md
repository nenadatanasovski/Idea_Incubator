# KNW-003: Query Interface for Agents

---

## Metadata

| Field          | Value               |
| -------------- | ------------------- |
| **Phase**      | 12 - Knowledge Base |
| **Depends On** | KNW-001, KNW-002    |
| **Blocks**     | SPC-006, BLD-002    |
| **Priority**   | P2                  |
| **Owner**      | Human + Claude Code |

---

## Summary

Implement a query interface for agents to retrieve relevant gotchas and patterns. Supports filtering by file pattern, action type, and minimum confidence.

---

## Requirements

1. **Query Functions**:
   - `getRelevantGotchas(filePattern, actionType)`
   - `getRelevantPatterns(fileType, actionType)`
   - `searchKnowledge(query)`

2. **Filtering**:
   - File pattern glob matching
   - Action type filtering
   - Confidence threshold

3. **Response Format**:
   - Structured JSON
   - Include confidence
   - Include usage count

---

## Pass Criteria

| #   | Criterion          | How to Verify      |
| --- | ------------------ | ------------------ |
| 1   | Queries work       | Test each function |
| 2   | Filtering accurate | Test with patterns |
| 3   | Performance OK     | Query < 100ms      |

---

## Output Files

```
agents/knowledge-base/index.ts
agents/knowledge-base/queries.ts
```

---

## Code Template

```typescript
export interface KnowledgeQuery {
  itemType?: "gotcha" | "pattern" | "decision";
  filePatterns?: string[];
  actionTypes?: string[];
  minConfidence?: number;
  limit?: number;
}

export async function queryKnowledge(
  query: KnowledgeQuery,
): Promise<KnowledgeEntry[]>;

export async function getRelevantGotchas(
  filePath: string,
  actionType?: string,
): Promise<Gotcha[]>;

export async function getRelevantPatterns(
  fileType: string,
  actionType?: string,
): Promise<Pattern[]>;
```
