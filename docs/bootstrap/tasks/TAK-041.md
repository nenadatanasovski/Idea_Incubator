# TAK-041: Create Task Agent Documentation

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 12 - Documentation |
| **Depends On** | TAK-016 |
| **Blocks** | None |
| **Priority** | P2 |
| **Owner** | Build Agent |

---

## Summary

Create comprehensive Task Agent documentation in `docs/agents/TASK-AGENT.md` covering capabilities, API reference, Telegram commands, configuration, and example workflows.

---

## Requirements

1. **Capabilities Section**:
   - Validation gate and blocking behavior
   - Deduplication and similarity detection
   - Dependency management
   - Test generation and execution
   - Priority calculation
   - Completion detection

2. **API Reference**:
   - All REST endpoints with request/response examples
   - WebSocket events with payload schemas
   - Error codes and handling

3. **Telegram Command Reference**:
   - All commands with arguments
   - Interactive flow diagrams
   - Notification behavior

4. **Configuration Options**:
   - Environment variables
   - Validation rules
   - Notification settings

5. **Example Workflows**:
   - Creating a task
   - Task validation flow
   - Executing a task list
   - Handling blocked tasks

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f docs/agents/TASK-AGENT.md` returns 0 |
| 2 | Has API reference | `grep -q "API Reference\|API Endpoints" docs/agents/TASK-AGENT.md` returns 0 |
| 3 | Has Telegram section | `grep -q "Telegram" docs/agents/TASK-AGENT.md` returns 0 |
| 4 | Has examples | `grep -q "Example\|example" docs/agents/TASK-AGENT.md` returns 0 |
| 5 | Has configuration | `grep -q "Configuration\|Environment" docs/agents/TASK-AGENT.md` returns 0 |

**FAIL** if any criterion is not met.

---

## Output Files

```
docs/agents/
â””â”€â”€ TASK-AGENT.md
```

---

## Code Template

```markdown
# Task Agent Documentation

## Overview

The Task Agent is an always-on orchestrator that manages the complete task lifecycle from creation through validation to completion.

## Capabilities

### Validation Gate
- Validates required fields
- Checks test requirements
- Detects ambiguous descriptions
- Creates blocking records for issues

### Deduplication Engine
- Generates task embeddings
- Finds similar tasks (>0.8 threshold)
- Suggests merge or link actions

### Dependency Management
- Prevents circular dependencies
- Auto-resolves when blockers complete
- Calculates critical path

### Test System
- Generates API and UI test scaffolds
- Executes tests via MCP Puppeteer
- Records results and screenshots

### Priority Calculator
Formula: `BlockedCount Ã— 20 + QuickWinBonus(10) + DeadlineBonus(5-15) + StrategicBonus`

## API Reference

### Create Task
\`\`\`
POST /api/task-agent/tasks
Content-Type: application/json

{
  "title": "Implement feature X",
  "description": "Detailed description...",
  "category": "feature",
  "projectId": "proj-001",
  "acceptanceCriteria": ["Criterion 1", "Criterion 2"],
  "apiTestCases": [...]
}
\`\`\`

### Validate Task
\`\`\`
POST /api/task-agent/tasks/:id/validate

Response:
{
  "valid": false,
  "blocking": true,
  "issues": [
    {
      "field": "apiTestCases",
      "severity": "error",
      "message": "Feature tasks require API tests",
      "autoFixable": false
    }
  ]
}
\`\`\`

## WebSocket Events

| Event | Payload |
|-------|---------|
| task:created | `{ taskId, title, category }` |
| task:blocked | `{ taskId, reason, blockType }` |
| task:unblocked | `{ taskId, unblockedBy }` |
| task:validation_passed | `{ taskId }` |
| task:validation_failed | `{ taskId, issues[] }` |

## Telegram Commands

### /start
Links current chat to a task list.
\`\`\`
/start my-project-tasks
\`\`\`

### /suggest
Gets the highest priority ready task.
\`\`\`
> /suggest

Next suggested task:
ðŸ“‹ TAK-015: Implement Test Executor
Priority: 85 (blocks 3 tasks)
Category: feature
Effort: ~2 hours

[Execute Now] [Later] [Details]
\`\`\`

## Configuration

### Environment Variables
\`\`\`
TELEGRAM_BOT_TASK_TOKEN=your-bot-token
TASK_AGENT_STALE_CHECK_HOURS=6
TASK_AGENT_NOTIFICATION_MIN_INTERVAL=5
\`\`\`

### Validation Rules
Configured in `server/services/task-agent/validation-rules.json`

## Example Workflows

### Creating a Task
1. User creates task via API or UI
2. ValidationGate checks required fields
3. DeduplicationEngine checks for similar tasks
4. ClassificationEngine auto-categorizes
5. Task is created with status 'draft' or 'blocked'

### Executing a Task List
1. Create task list with selected tasks
2. Link to Telegram chat via /start
3. Task Agent suggests highest priority ready task
4. User approves via /execute
5. Tasks run sequentially, blocked tasks skipped
6. Notifications sent on completion/failure
```

---

## Validation

```bash
# Verify file exists and has required sections
test -f docs/agents/TASK-AGENT.md && echo "File exists: OK"
grep -q "API Reference" docs/agents/TASK-AGENT.md && echo "API section: OK"
grep -q "Telegram" docs/agents/TASK-AGENT.md && echo "Telegram section: OK"
grep -q "Configuration" docs/agents/TASK-AGENT.md && echo "Config section: OK"
```

---

## Next Steps

After completing this task:
1. Add link to new docs from CLAUDE.md
2. Add link from frontend help page
3. Review for accuracy against implementation
