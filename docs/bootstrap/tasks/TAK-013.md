# TAK-013: DependencyManager Service

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 3 - Core Services |
| **Depends On** | TAK-002, TAK-007 |
| **Blocks** | TAK-015a (PriorityCalculator), TAK-016 (TaskAgent) |
| **Priority** | P1 |
| **Owner** | Build Agent |

---

## Summary

Implement the DependencyManager class that handles task dependencies, detects circular dependencies, calculates critical path, and auto-resolves when blockers complete.

---

## Requirements

1. **DependencyManager class**:
   - Add/remove task dependencies
   - Detect circular dependencies before adding
   - Calculate critical path
   - Auto-resolve when blockers complete
   - Generate dependency graph

2. **Methods**:
   - `addDependency(sourceId, targetId, type): Promise<void>`
   - `removeDependency(sourceId, targetId): Promise<void>`
   - `detectCycle(sourceId, targetId): Promise<boolean>`
   - `getBlockers(taskId): Promise<Task[]>`
   - `getBlocked(taskId): Promise<Task[]>`
   - `getCriticalPath(taskListId): Promise<Task[]>`
   - `onTaskCompleted(taskId): Promise<void>` (auto-unblock)

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f server/services/task-agent/dependency-manager.ts` returns 0 |
| 2 | Exports DependencyManager | `grep -q "export class DependencyManager" server/services/task-agent/dependency-manager.ts` returns 0 |
| 3 | Has detectCycle | `grep -q "detectCycle" server/services/task-agent/dependency-manager.ts` returns 0 |
| 4 | Has getCriticalPath | `grep -q "getCriticalPath" server/services/task-agent/dependency-manager.ts` returns 0 |
| 5 | TypeScript compiles | `npx tsc --noEmit server/services/task-agent/dependency-manager.ts` returns 0 |

**FAIL** if any criterion is not met.

---

## Output Files

```
server/services/task-agent/
└── dependency-manager.ts
```

---

## Gotchas

- Check for cycles before adding dependency
- Subscribe to task.completed events for auto-resolution
- Use graph traversal algorithms for critical path

---

## Validation

```bash
npx tsc --noEmit server/services/task-agent/dependency-manager.ts
npm test -- --grep "dependency-manager"
```

---

## Next Steps

After completing: Implement CompletionDetector (TAK-014).
