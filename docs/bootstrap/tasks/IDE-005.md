# IDE-005: Handoff Document Generation

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 3 - Ideation System |
| **Depends On** | IDE-002, IDE-003 |
| **Blocks** | Specification Agent |
| **Priority** | P1 |
| **Owner** | Human + Claude Code |

---

## Summary

Generate a comprehensive handoff document (brief.md) when an ideation session completes. This document captures all the context needed for the Specification Agent to create a technical specification.

---

## Context

### Handoff Document Purpose

The brief serves as the bridge between ideation and specification:

| From Ideation | To Specification |
|---------------|------------------|
| Problem understanding | Requirements derivation |
| Target users | User stories |
| Solution concept | Technical approach |
| MVP scope | Feature prioritization |
| Risks identified | Risk mitigation in design |

### Brief Structure

```markdown
# {Idea Name} - Handoff Brief

## Executive Summary
One paragraph overview of the idea.

## Problem Statement
What problem are we solving and for whom?

## Target Users
Primary and secondary user personas.

## Solution Overview
High-level description of the solution.

## MVP Scope
What's in scope for the first version?

## Key Features
List of features with priorities.

## Risks & Considerations
Known risks and how to address them.

## Open Questions
Questions still needing answers.

## Context Files
Links to related research and documents.
```

---

## Requirements

1. **Brief Generator**:
   - Compile signals into coherent document
   - Use Claude to synthesize and write
   - Follow standard template

2. **Context Aggregation**:
   - Pull from all session signals
   - Include relevant research
   - Reference related artifacts

3. **Quality Validation**:
   - Check all required sections present
   - Validate completeness score
   - Highlight gaps

4. **File Integration**:
   - Save to `planning/brief.md`
   - Update idea metadata
   - Emit completion event

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | Brief generated | File exists at planning/brief.md |
| 2 | All sections populated | Parse and check sections |
| 3 | Signals included | Verify artifacts referenced |
| 4 | Spec Agent can use it | Test spec generation from brief |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/ideation/handoff-generator.ts       <- Generation logic
templates/unified/planning/brief.md.template <- Brief template
tests/ideation/handoff-generation.test.ts
```

---

## Code Template

```typescript
// agents/ideation/handoff-generator.ts

interface BriefContent {
  executiveSummary: string;
  problemStatement: string;
  targetUsers: string;
  solutionOverview: string;
  mvpScope: string;
  keyFeatures: Feature[];
  risks: Risk[];
  openQuestions: string[];
  contextFiles: string[];
}

export async function generateHandoffBrief(
  session: IdeationSession
): Promise<string> {
  // 1. Aggregate all signals
  const signals = session.signals;

  // 2. Build brief content from signals
  const content: Partial<BriefContent> = {
    problemStatement: findSignal(signals, 'problem')?.content,
    targetUsers: findSignal(signals, 'target-user')?.content,
    // ... etc
  };

  // 3. Use Claude to synthesize missing pieces
  const completedContent = await synthesizeWithClaude(content, signals);

  // 4. Render template
  const brief = renderTemplate('planning/brief.md.template', completedContent);

  // 5. Validate completeness
  const validation = validateBrief(brief);
  if (!validation.valid) {
    console.warn('[Handoff] Brief incomplete:', validation.missing);
  }

  // 6. Save to file system
  await saveArtifact(
    session.userId,
    session.ideaSlug!,
    'brief',
    brief
  );

  return brief;
}
```

---

## Validation

```bash
# Run handoff tests
npm test -- tests/ideation/handoff-generation.test.ts

# Manual test
# 1. Complete an ideation session
# 2. Verify brief generated
cat users/{user}/ideas/{idea}/planning/brief.md

# 3. Test with Spec Agent
npm run spec:generate -- --idea={idea}
```

---

## Next Steps

After completing: Tune confidence calculation (IDE-006).
