# IDE-006: Confidence Calculation Tuning

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 3 - Ideation System |
| **Depends On** | IDE-003 |
| **Blocks** | None |
| **Priority** | P3 |
| **Owner** | Human + Claude Code |

---

## Summary

Tune the confidence calculation algorithm to provide more accurate and useful confidence scores for ideation sessions. Confidence indicates how "ready" an idea is for the next phase.

---

## Context

### Confidence Components

| Component | Weight | Description |
|-----------|--------|-------------|
| **Completeness** | 30% | Are all expected artifacts present? |
| **Clarity** | 25% | How well-defined is the idea? |
| **Validation** | 25% | Have assumptions been tested? |
| **Consistency** | 20% | Do all pieces fit together? |

### Current Issues

| Issue | Impact |
|-------|--------|
| Scores too high early | False confidence |
| Doesn't account for quality | Quantity over quality |
| No explanation | User doesn't understand score |

---

## Requirements

1. **Component Scoring**:
   - Score each component independently
   - Use weighted average for overall
   - Cap individual components at 100%

2. **Quality Factors**:
   - Consider artifact depth, not just presence
   - Penalize vague or generic content
   - Reward specific, actionable details

3. **Score Explanation**:
   - Provide breakdown by component
   - Highlight strengths and weaknesses
   - Suggest improvements

4. **Calibration**:
   - Test against known good/bad sessions
   - Adjust weights based on outcomes
   - Track prediction accuracy

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | Components calculated | All 4 components scored |
| 2 | Explanation provided | API returns breakdown |
| 3 | Scores realistic | Manual review of samples |
| 4 | Improvements suggested | Check suggestions array |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/ideation/confidence-calculator.ts   <- Calculation logic
agents/ideation/confidence-explainer.ts    <- Explanation generation
tests/ideation/confidence.test.ts
```

---

## Code Template

```typescript
// agents/ideation/confidence-calculator.ts

interface ConfidenceResult {
  overall: number;  // 0-100
  components: {
    completeness: ComponentScore;
    clarity: ComponentScore;
    validation: ComponentScore;
    consistency: ComponentScore;
  };
  explanation: string;
  suggestions: string[];
}

interface ComponentScore {
  score: number;
  weight: number;
  factors: string[];
}

const COMPONENT_WEIGHTS = {
  completeness: 0.30,
  clarity: 0.25,
  validation: 0.25,
  consistency: 0.20
};

export function calculateConfidence(
  signals: ExtractedSignals,
  phase: string
): ConfidenceResult {
  const completeness = calculateCompleteness(signals, phase);
  const clarity = calculateClarity(signals);
  const validation = calculateValidation(signals);
  const consistency = calculateConsistency(signals);

  const overall = Math.round(
    completeness.score * COMPONENT_WEIGHTS.completeness +
    clarity.score * COMPONENT_WEIGHTS.clarity +
    validation.score * COMPONENT_WEIGHTS.validation +
    consistency.score * COMPONENT_WEIGHTS.consistency
  );

  const suggestions = generateSuggestions({
    completeness, clarity, validation, consistency
  });

  return {
    overall,
    components: { completeness, clarity, validation, consistency },
    explanation: generateExplanation(overall, phase),
    suggestions
  };
}
```

---

## Validation

```bash
# Run confidence tests
npm test -- tests/ideation/confidence.test.ts

# Test with sample sessions
# Low confidence (early session)
# Medium confidence (partial completion)
# High confidence (near complete)
```

---

## Next Steps

After completing: Add multi-idea session support (IDE-007, optional P4).
