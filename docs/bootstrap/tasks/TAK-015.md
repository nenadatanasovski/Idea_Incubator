# TAK-015: TestExecutor Service

---

## Metadata

| Field          | Value               |
| -------------- | ------------------- |
| **Phase**      | 3 - Core Services   |
| **Depends On** | TAK-004, TAK-007    |
| **Blocks**     | TAK-016 (TaskAgent) |
| **Priority**   | P1                  |
| **Owner**      | Build Agent         |

---

## Summary

Implement the TestExecutor class that executes API tests via HTTP requests and UI tests via MCP Puppeteer, recording results in the database.

---

## Requirements

1. **TestExecutor class**:
   - Execute API tests via HTTP requests
   - Execute UI tests via MCP Puppeteer
   - Record results in task_test_results table
   - Capture screenshots for UI test failures
   - Report aggregate pass/fail status

2. **Methods**:
   - `executeTests(taskId): Promise<TestExecutionResult>`
   - `executeAPITest(testCase): Promise<TestResult>`
   - `executeUITest(testCase): Promise<TestResult>`
   - `recordResult(taskId, testCaseId, result): Promise<void>`
   - `captureScreenshot(name): Promise<string>`

---

## Pass Criteria

**PASS** when ALL of the following are true:

| #   | Criterion              | How to Verify                                                                                   |
| --- | ---------------------- | ----------------------------------------------------------------------------------------------- |
| 1   | File exists            | `test -f server/services/task-agent/test-executor.ts` returns 0                                 |
| 2   | Exports TestExecutor   | `grep -q "export class TestExecutor" server/services/task-agent/test-executor.ts` returns 0     |
| 3   | Has executeAPITest     | `grep -q "executeAPITest" server/services/task-agent/test-executor.ts` returns 0                |
| 4   | Has executeUITest      | `grep -q "executeUITest" server/services/task-agent/test-executor.ts` returns 0                 |
| 5   | Has screenshot capture | `grep -q "captureScreenshot\|screenshot" server/services/task-agent/test-executor.ts` returns 0 |
| 6   | TypeScript compiles    | `npx tsc --noEmit server/services/task-agent/test-executor.ts` returns 0                        |

**FAIL** if any criterion is not met.

---

## Output Files

```
server/services/task-agent/
└── test-executor.ts
```

---

## Gotchas

- Use mcp**puppeteer**\* tools for UI tests
- Implement timeout handling for long-running tests
- Store screenshots in consistent location

---

## Validation

```bash
npx tsc --noEmit server/services/task-agent/test-executor.ts
npm test -- --grep "test-executor"
```

---

## Next Steps

After completing: Implement PriorityCalculator (TAK-015a).
