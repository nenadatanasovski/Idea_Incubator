# BLD-006: Validation Runner

---

## Metadata

| Field          | Value                    |
| -------------- | ------------------------ |
| **Phase**      | 2 - Build Agent          |
| **Depends On** | BLD-003, BLD-005         |
| **Blocks**     | BLD-008                  |
| **Priority**   | P1                       |
| **Owner**      | Human (then Build Agent) |

---

## Summary

Run validation commands from task definitions to verify each build step succeeds.

---

## Requirements

1. **Command Execution**:
   - Run validation command from task
   - Capture stdout, stderr, exit code
   - Apply timeout limits

2. **Result Parsing**:
   - Compare output to expected
   - Parse test results
   - Identify specific failures

3. **Feedback Generation**:
   - Generate actionable feedback on failure
   - Include relevant context
   - Suggest fixes

---

## Pass Criteria

**PASS** when ALL of the following are true:

| #   | Criterion                | How to Verify                                                                         |
| --- | ------------------------ | ------------------------------------------------------------------------------------- |
| 1   | File exists              | `test -f agents/build/validation-runner.ts` returns 0                                 |
| 2   | Exports ValidationRunner | `grep -q "export class ValidationRunner" agents/build/validation-runner.ts` returns 0 |
| 3   | Has run method           | `grep -q "run(" agents/build/validation-runner.ts` returns 0                          |
| 4   | Has timeout handling     | `grep -q "timeout" agents/build/validation-runner.ts` returns 0                       |
| 5   | Parses results           | `grep -q "parseResult" agents/build/validation-runner.ts` returns 0                   |
| 6   | TypeScript compiles      | `npx tsc --noEmit agents/build/validation-runner.ts` returns 0                        |
| 7   | Unit tests pass          | `npm test -- --grep "validation-runner"` passes                                       |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/build/
└── validation-runner.ts
```

---

## Code Template

```typescript
// agents/build/validation-runner.ts

export interface ValidationResult {
  taskId: string;
  passed: boolean;
  command: string;
  stdout: string;
  stderr: string;
  exitCode: number;
  feedback?: string;
}

export class ValidationRunner {
  async run(task: AtomicTask): Promise<ValidationResult> {
    // Execute validation command
  }

  private parseResult(output: string, expected: string): boolean {
    // Compare against expected
  }

  private generateFeedback(result: ValidationResult): string {
    // Actionable feedback for retry
  }
}
```

---

## Validation

```bash
npx tsc --noEmit agents/build/validation-runner.ts
npm test -- --grep "validation-runner"
```
