# FND-001: Database Schema Review and Cleanup

---

## Metadata

| Field          | Value                              |
| -------------- | ---------------------------------- |
| **Phase**      | 1 - Foundation                     |
| **Depends On** | None                               |
| **Blocks**     | FND-002, All agent implementations |
| **Priority**   | P2                                 |
| **Owner**      | Human + Claude Code                |

---

## Summary

Review the existing database schema for consistency, identify orphaned tables, remove deprecated columns, and ensure all tables follow naming conventions and have proper indexes.

---

## Context

### Why Database Schema Review?

| Benefit             | Description                                  |
| ------------------- | -------------------------------------------- |
| **Consistency**     | All tables follow same naming conventions    |
| **Performance**     | Proper indexes on frequently queried columns |
| **Maintainability** | Remove dead code and deprecated structures   |
| **Documentation**   | Clear understanding of data model            |

### Key Areas to Review

| Area            | Check For                                             |
| --------------- | ----------------------------------------------------- |
| **Naming**      | snake_case, plural table names, singular column names |
| **Types**       | TEXT for dates in SQLite, proper INTEGER for booleans |
| **Indexes**     | Foreign keys, frequently filtered columns             |
| **Constraints** | NOT NULL where appropriate, defaults                  |

---

## Requirements

1. **Audit Existing Tables**:
   - List all tables in database
   - Document purpose of each table
   - Identify unused or deprecated tables

2. **Naming Convention Compliance**:
   - Table names: snake_case, plural (e.g., `ideation_sessions`)
   - Column names: snake_case, singular (e.g., `created_at`)
   - Foreign keys: `{referenced_table}_id` (e.g., `user_id`)

3. **Index Analysis**:
   - All foreign keys should have indexes
   - Frequently queried columns should be indexed
   - Remove unused indexes

4. **Data Type Consistency**:
   - Dates stored as TEXT (ISO-8601 format)
   - Booleans stored as INTEGER (0/1)
   - IDs stored as TEXT (UUIDs)

---

## Pass Criteria

**PASS** when ALL of the following are true:

| #   | Criterion                   | How to Verify                     |
| --- | --------------------------- | --------------------------------- |
| 1   | All tables documented       | Schema documentation updated      |
| 2   | Naming conventions followed | Manual review of schema           |
| 3   | No orphaned tables          | All tables have referencing code  |
| 4   | Indexes on foreign keys     | Query `sqlite_master` for indexes |

**FAIL** if any criterion is not met.

---

## Output Files

```
docs/database-schema.md          <- Schema documentation
database/migrations/cleanup.sql  <- Cleanup migration (if needed)
```

---

## Validation

```bash
# List all tables
sqlite3 database/ideas.db ".tables"

# Check indexes
sqlite3 database/ideas.db ".indexes"

# Verify naming conventions
sqlite3 database/ideas.db ".schema" | grep -E "CREATE TABLE"
```

---

## Next Steps

After completing: Run pending migrations (FND-002) to ensure schema is up to date.
