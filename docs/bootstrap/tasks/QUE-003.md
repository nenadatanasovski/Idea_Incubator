# QUE-003: Answer Processing and Agent Resume

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 4 - Question System |
| **Depends On** | QUE-002, ORC-001 |
| **Blocks** | None |
| **Priority** | P1 |
| **Owner** | Build Agent |

---

## Summary

Process user answers and signal waiting agents to resume work.

---

## Requirements

1. **Answer Processing**:
   - Validate answer against question options
   - Store answer in database
   - Update question status
   - Handle "use default" answers

2. **Agent Notification**:
   - Notify waiting agent via event bus
   - Include answer in notification
   - Handle agent not found (stale question)

3. **Resume Flow**:
   - Agent receives answer
   - Agent validates answer is usable
   - Agent continues from blocked state
   - Handle invalid answer (re-ask)

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f server/routes/questions/answer.ts` returns 0 |
| 2 | Has processAnswer | `grep -q "processAnswer" server/routes/questions/answer.ts` returns 0 |
| 3 | Has notifyAgent | `grep -q "notifyAgent" server/routes/questions/answer.ts` returns 0 |
| 4 | Validates answer | `grep -q "validate" server/routes/questions/answer.ts` returns 0 |
| 5 | Updates database | `grep -q "update\|INSERT" server/routes/questions/answer.ts` returns 0 |
| 6 | TypeScript compiles | `npx tsc --noEmit server/routes/questions/answer.ts` returns 0 |
| 7 | E2E test passes | Manual: answer question, verify agent resumes |

**FAIL** if any criterion is not met.

---

## Output Files

```
server/routes/questions/
└── answer.ts
```

---

## Code Template

```typescript
// server/routes/questions/answer.ts

export interface AnswerRequest {
  questionId: string;
  answer: string;
  useDefault?: boolean;
}

export interface AnswerResult {
  success: boolean;
  agentNotified: boolean;
  error?: string;
}

export async function processAnswer(
  req: AnswerRequest,
  db: Database,
  eventBus: EventBus
): Promise<AnswerResult> {
  // 1. Validate answer
  // 2. Store in database
  // 3. Update question status
  // 4. Notify agent
}

async function notifyAgent(
  agentId: string,
  questionId: string,
  answer: string,
  eventBus: EventBus
): Promise<boolean> {
  // Emit answer event for agent
}
```

---

## Validation

```bash
npx tsc --noEmit server/routes/questions/answer.ts
# Manual: submit answer, verify agent resumes
```
