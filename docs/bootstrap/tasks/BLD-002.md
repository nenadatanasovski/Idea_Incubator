# BLD-002: Context Primer Implementation

---

## Metadata

| Field          | Value                    |
| -------------- | ------------------------ |
| **Phase**      | 2 - Build Agent          |
| **Depends On** | BLD-001                  |
| **Blocks**     | BLD-003                  |
| **Priority**   | P1                       |
| **Owner**      | Human (then Build Agent) |

---

## Summary

Implement context primer that loads spec, tasks, and relevant codebase context before each build task.

---

## Requirements

1. **Spec Loading**:
   - Load current task from tasks.md
   - Load related spec sections
   - Load dependency task outputs

2. **Codebase Context**:
   - Load CLAUDE.md conventions
   - Load related existing files
   - Load type definitions

3. **Context Assembly**:
   - Prioritize by relevance to current task
   - Respect token limits
   - Include gotchas for current file pattern

---

## Pass Criteria

**PASS** when ALL of the following are true:

| #   | Criterion               | How to Verify                                                                   |
| --- | ----------------------- | ------------------------------------------------------------------------------- |
| 1   | File exists             | `test -f agents/build/context-primer.ts` returns 0                              |
| 2   | Exports ContextPrimer   | `grep -q "export class ContextPrimer" agents/build/context-primer.ts` returns 0 |
| 3   | Has loadTask method     | `grep -q "loadTask(" agents/build/context-primer.ts` returns 0                  |
| 4   | Has loadCodebase method | `grep -q "loadCodebase(" agents/build/context-primer.ts` returns 0              |
| 5   | Handles token limits    | `grep -q "tokenLimit" agents/build/context-primer.ts` returns 0                 |
| 6   | TypeScript compiles     | `npx tsc --noEmit agents/build/context-primer.ts` returns 0                     |
| 7   | Unit tests pass         | `npm test -- --grep "context-primer"` passes                                    |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/build/
└── context-primer.ts
```

---

## Code Template

```typescript
// agents/build/context-primer.ts

export interface TaskContext {
  task: AtomicTask;
  specSections: string[];
  dependencyOutputs: Record<string, string>;
  conventions: string;
  relatedFiles: Record<string, string>;
  gotchas: Gotcha[];
  tokenCount: number;
}

export class ContextPrimer {
  async loadForTask(taskId: string, specPath: string): Promise<TaskContext> {
    // Assemble context for specific task
  }

  private loadDependencyOutputs(task: AtomicTask): Record<string, string> {
    // Load files created by dependency tasks
  }
}
```

---

## Validation

```bash
npx tsc --noEmit agents/build/context-primer.ts
npm test -- --grep "context-primer"
```
