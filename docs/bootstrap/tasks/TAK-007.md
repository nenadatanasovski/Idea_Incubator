# TAK-007: Task Agent TypeScript Types

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 2 - TypeScript Types |
| **Depends On** | TAK-001 |
| **Blocks** | All Phase 3 services (TAK-008 to TAK-016) |
| **Priority** | P1 |
| **Owner** | Build Agent |

---

## Summary

Create TypeScript type definitions for all Task Agent entities: Task, TaskCategory, TaskStatus, ValidationResult, TestCase interfaces, and more.

---

## Requirements

1. **Task Types**:
   - TaskCategory (16 types: feature, improvement, bug, etc.)
   - TaskStatus (9 states: draft, pending, blocked, in_progress, etc.)
   - Task interface with all fields

2. **Validation Types**:
   - ValidationResult with valid, blocking, issues, suggestions
   - ValidationIssue with field, severity, message, ruleId, autoFixable

3. **Test Case Types**:
   - APITestCase with method, endpoint, headers, body, expected
   - UITestCase with startUrl, viewport, steps, assertions
   - UITestStep and UIAssertion interfaces

4. **Relationship Types**:
   - TaskRelationship with 11 relationship types
   - TaskBlock with block types and resolution tracking

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | File exists | `test -f types/task-agent.ts` returns 0 |
| 2 | Exports TaskCategory | `grep -q "export type TaskCategory" types/task-agent.ts` returns 0 |
| 3 | Exports TaskStatus | `grep -q "export type TaskStatus" types/task-agent.ts` returns 0 |
| 4 | Exports Task interface | `grep -q "export interface Task" types/task-agent.ts` returns 0 |
| 5 | Exports ValidationResult | `grep -q "export interface ValidationResult" types/task-agent.ts` returns 0 |
| 6 | Exports APITestCase | `grep -q "export interface APITestCase" types/task-agent.ts` returns 0 |
| 7 | Exports UITestCase | `grep -q "export interface UITestCase" types/task-agent.ts` returns 0 |
| 8 | TypeScript compiles | `npx tsc --noEmit types/task-agent.ts` returns 0 |

**FAIL** if any criterion is not met.

---

## Output Files

```
types/
└── task-agent.ts
```

---

## Code Template

```typescript
// Task Agent Types

export type TaskCategory =
  | 'feature'
  | 'improvement'
  | 'bug'
  | 'investigation'
  | 'technical_debt'
  | 'infrastructure'
  | 'documentation'
  | 'refactoring'
  | 'security'
  | 'performance'
  | 'testing'
  | 'migration'
  | 'integration'
  | 'ux_design'
  | 'maintenance'
  | 'decommissioned';

export type TaskStatus =
  | 'draft'
  | 'pending'
  | 'blocked'
  | 'in_progress'
  | 'validating'
  | 'failed'
  | 'stale'
  | 'completed'
  | 'cancelled';

export interface Task {
  id: string;
  title: string;
  description: string;
  category: TaskCategory;
  status: TaskStatus;
  priority: number;

  // Relationships
  parentId?: string;
  projectId: string;
  ideaSlug?: string;

  // Validation
  acceptanceCriteria: string[];
  apiTestCases: APITestCase[];
  uiTestCases: UITestCase[];
  validationCommand?: string;
  validationStatus: 'pending' | 'passed' | 'failed';
  validationIssues: ValidationIssue[];
  blockingReason?: string;

  // Execution
  assignedAgent?: string;
  estimatedEffort?: string;
  actualEffortMinutes?: number;

  // Metadata
  createdBy: string;
  createdAt: string;
  updatedAt: string;
  startedAt?: string;
  completedAt?: string;
}

export interface ValidationResult {
  valid: boolean;
  blocking: boolean;
  issues: ValidationIssue[];
  suggestions: string[];
}

export interface ValidationIssue {
  field: string;
  severity: 'error' | 'warning' | 'info';
  message: string;
  ruleId: string;
  autoFixable: boolean;
  suggestedFix?: string;
}

export interface APITestCase {
  id: string;
  name: string;
  description: string;
  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';
  endpoint: string;
  headers?: Record<string, string>;
  body?: Record<string, unknown>;
  expectedStatus: number;
  expectedBody?: Record<string, unknown>;
  responseValidation?: {
    schema?: object;
    contains?: string[];
    matches?: RegExp;
  };
  setup?: string;
  teardown?: string;
}

export interface UITestCase {
  id: string;
  name: string;
  description: string;
  startUrl: string;
  viewport?: { width: number; height: number };
  steps: UITestStep[];
  assertions: UIAssertion[];
  captureScreenshots: boolean;
  screenshotOnFailure: boolean;
}

export interface UITestStep {
  action: 'navigate' | 'click' | 'type' | 'select' | 'wait' | 'scroll' | 'screenshot' | 'hover';
  selector?: string;
  value?: string;
  timeout?: number;
  description: string;
}

export interface UIAssertion {
  type: 'element_exists' | 'element_visible' | 'text_contains' | 'url_matches' | 'element_count';
  selector?: string;
  expected: string | number | boolean;
  description: string;
}

export type RelationshipType =
  | 'depends_on'
  | 'blocks'
  | 'related_to'
  | 'duplicate_of'
  | 'subtask_of'
  | 'supersedes'
  | 'implements'
  | 'conflicts_with'
  | 'enables'
  | 'inspired_by'
  | 'tests';

export interface TaskRelationship {
  id: string;
  sourceTaskId: string;
  targetTaskId: string;
  relationshipType: RelationshipType;
  strength?: number;
  createdAt: string;
}

export type BlockType = 'validation' | 'dependency' | 'manual' | 'ambiguous' | 'missing_tests';

export interface TaskBlock {
  id: string;
  taskId: string;
  blockType: BlockType;
  reason: string;
  blockingEntityId?: string;
  severity: 'error' | 'warning';
  createdAt: string;
  resolvedAt?: string;
  resolvedBy?: string;
}

export interface TaskList {
  id: string;
  name: string;
  description?: string;
  status: 'draft' | 'active' | 'paused' | 'completed' | 'archived';
  projectId?: string;
  ideaSlug?: string;
  telegramChatId?: string;
  executionMode: 'sequential' | 'parallel' | 'priority';
  currentTaskId?: string;
  tasksCompleted: number;
  tasksTotal: number;
  createdBy: string;
  createdAt: string;
  updatedAt: string;
}

export interface TaskQuestion {
  id: string;
  taskId?: string;
  taskListId?: string;
  questionType: 'approval' | 'clarification' | 'decision' | 'escalation';
  questionText: string;
  context?: Record<string, unknown>;
  options?: string[];
  status: 'pending' | 'answered' | 'expired' | 'cancelled';
  answer?: string;
  answeredBy?: string;
  answeredAt?: string;
  priority: number;
  expiresAt?: string;
  createdAt: string;
}
```

---

## Gotchas

- IDs are always string (UUIDs)
- Dates are ISO strings (TEXT in SQLite)
- Use type unions instead of enums for better tree-shaking

---

## Validation

```bash
npx tsc --noEmit types/task-agent.ts
```

---

## Next Steps

After completing: Implement ValidationGate service (TAK-008).
