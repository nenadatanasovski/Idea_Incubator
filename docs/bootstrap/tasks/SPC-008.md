# SPC-008: Pass Acceptance Tests

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 1 - Spec Agent |
| **Depends On** | SPC-001, SPC-002, SPC-003, SPC-004, SPC-005, SPC-006, SPC-007, AGT-004 |
| **Blocks** | BLD-001 |
| **Priority** | P1 |
| **Owner** | Build Agent (after Phase 1) |

---

## Summary

Integrate all Spec Agent components and pass the acceptance tests from AGT-004. This is the "done" criteria for Phase 1.

---

## Requirements

1. **Core Integration**:
   - Wire up all components (context, parser, Claude, templates)
   - Create main SpecAgent class
   - Implement generateSpec() method

2. **Test Compliance**:
   - Pass simple feature test (>= 80% similarity)
   - Pass medium feature test (>= 80% similarity)
   - Pass complex feature test (>= 80% similarity)
   - Pass schema validation tests
   - Pass implementability tests

3. **Error Handling**:
   - Graceful failure modes
   - Clear error messages
   - Escape hatch documentation

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | Core file exists | `test -f agents/specification/core.ts` returns 0 |
| 2 | Exports SpecAgent | `grep -q "export class SpecAgent" agents/specification/core.ts` returns 0 |
| 3 | Has generateSpec method | `grep -q "generateSpec(" agents/specification/core.ts` returns 0 |
| 4 | TypeScript compiles | `npx tsc --noEmit agents/specification/*.ts` returns 0 |
| 5 | Simple test passes | `npm test -- --grep "Simple Feature"` passes |
| 6 | Medium test passes | `npm test -- --grep "Medium Feature"` passes |
| 7 | Complex test passes | `npm test -- --grep "Complex Feature"` passes |
| 8 | Schema test passes | `npm test -- --grep "Schema Validation"` passes |
| 9 | Implementability passes | `npm test -- --grep "Implementability"` passes |
| 10 | All acceptance tests | `npm test -- --grep "spec-agent"` all pass |

**FAIL** if any criterion is not met.

---

## Output Files

```
agents/specification/
├── core.ts              ← Main SpecAgent class
├── context-loader.ts    ← From SPC-001
├── template-renderer.ts ← From SPC-002
├── brief-parser.ts      ← From SPC-003
├── claude-client.ts     ← From SPC-004
├── task-generator.ts    ← From SPC-005
├── gotcha-injector.ts   ← From SPC-006
├── question-generator.ts← From SPC-007
└── prompts/
    ├── system.ts
    ├── analyze.ts
    └── tasks.ts
```

---

## Code Template

```typescript
// agents/specification/core.ts

import { ContextLoader } from './context-loader';
import { TemplateRenderer } from './template-renderer';
import { BriefParser } from './brief-parser';
import { ClaudeClient } from './claude-client';
import { TaskGenerator } from './task-generator';
import { GotchaInjector } from './gotcha-injector';
import { QuestionGenerator } from './question-generator';

export interface SpecOutput {
  spec: string;      // spec.md content
  tasks: string;     // tasks.md content
  questions: Question[];
}

export interface GenerateOptions {
  ideaSlug: string;
  briefPath: string;
  skipQuestions?: boolean;
}

export class SpecAgent {
  private contextLoader: ContextLoader;
  private templateRenderer: TemplateRenderer;
  private briefParser: BriefParser;
  private claudeClient: ClaudeClient;
  private taskGenerator: TaskGenerator;
  private gotchaInjector: GotchaInjector;
  private questionGenerator: QuestionGenerator;

  constructor() {
    // Initialize all components
  }

  async generateSpec(options: GenerateOptions): Promise<SpecOutput> {
    // 1. Load context
    // 2. Parse brief
    // 3. Generate questions (if any)
    // 4. Analyze with Claude
    // 5. Generate tasks
    // 6. Inject gotchas
    // 7. Render templates
    // 8. Return output
  }
}
```

---

## Validation

```bash
# Run all acceptance tests
npm test -- --grep "spec-agent"

# Check all tests pass
npm test -- --grep "spec-agent" 2>&1 | grep -q "✓" && echo "PASS" || echo "FAIL"
```

---

## Next Steps

After completing: Spec Agent v0.1 is done. Use it to generate spec for Build Agent (BLD-001).
