# SEC-001: User Authentication System

---

## Metadata

| Field | Value |
|-------|-------|
| **Phase** | 5 - Security |
| **Depends On** | FND-002 |
| **Blocks** | SEC-002, NTF-001 |
| **Priority** | P1 |
| **Owner** | Build Agent |

---

## Summary

Implement basic user authentication for the web dashboard and API.

---

## Requirements

1. **Authentication Methods**:
   - Email/password login
   - Magic link (passwordless)
   - Optional: OAuth (Google, GitHub)

2. **User Storage**:
   - Users table with secure password hash
   - Email verification status
   - Last login timestamp

3. **Security**:
   - Password hashing with bcrypt
   - Rate limiting on login attempts
   - Secure session tokens

---

## Pass Criteria

**PASS** when ALL of the following are true:

| # | Criterion | How to Verify |
|---|-----------|---------------|
| 1 | Auth module exists | `test -f server/auth/index.ts` returns 0 |
| 2 | Has login function | `grep -q "login" server/auth/index.ts` returns 0 |
| 3 | Has register function | `grep -q "register" server/auth/index.ts` returns 0 |
| 4 | Uses bcrypt | `grep -q "bcrypt" server/auth/index.ts` returns 0 |
| 5 | Users table exists | `sqlite3 database/ideas.db ".schema users"` shows table |
| 6 | Rate limiting works | Manual: 5 failed logins triggers lockout |
| 7 | TypeScript compiles | `npx tsc --noEmit server/auth/index.ts` returns 0 |

**FAIL** if any criterion is not met.

---

## Output Files

```
server/auth/
├── index.ts
├── password.ts
├── magic-link.ts
└── middleware.ts

database/migrations/
└── 026_users.sql
```

---

## Code Template

```typescript
// server/auth/index.ts

import bcrypt from 'bcrypt';

export interface User {
  id: string;
  email: string;
  passwordHash: string;
  emailVerified: boolean;
  createdAt: Date;
  lastLoginAt: Date;
}

export async function register(email: string, password: string): Promise<User> {
  const hash = await bcrypt.hash(password, 12);
  // Store user
}

export async function login(email: string, password: string): Promise<string> {
  // Verify password, return session token
}

export async function sendMagicLink(email: string): Promise<void> {
  // Generate and email magic link
}
```

---

## Validation

```bash
npx tsc --noEmit server/auth/index.ts
npm run migrate
# Manual: register user, login, verify session
```
